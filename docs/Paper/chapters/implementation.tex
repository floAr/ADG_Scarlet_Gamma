\chapter{Implementierung}
\label{implementation}

Der Prototyp versucht zum einen die Welt vollständig editierbar und zum anderen in Echtzeit verwaltbar zu machen. Dies kann durch einen Baukasten aus elementaren Grundfunktionen erreicht werden. Im folgenden werden einige dieser Bausteine erläutert und gezeigt wie sie helfen das Ziel zu erreichen.

\section{Objektsystem}
\label{sec:Objektsystem}
Alles in der künstlichen Spielwelt muss den gleichen Prinzipien folgen. Ausnahmefälle oder grundsätzlich unterschiedliche Realisierungen verschiedener Entitäten wie Spieler und Boden würden es nicht erlauben in jeder Richtung agieren zu können. Aus diesem Grund ist alles in Form gleichartiger Objekte definiert. Ein Objekt ist eine Sammlung von Eigenschaften mit teils vordefinierter und teils fiktiver Bedeutung, welche zur Laufzeit definiert werden. Ein Objekt selbst ist demnach nur ein Container ohne weitere Funktionalität. Dies folgt dem Konzept der Komponentenbasierten Softwareentwicklung welches unter anderem in \cite{CBSE} beschrieben wird.\newline
Der Vorteil im Container-Ansatz liegt darin, dass sich alles in der Spielwelt in alles andere transformieren lässt, ohne dass es von den Entwicklern berücksichtigt werden muss.\newline
Existiert ein Editor für ein solches System gibt es nun die Option neue Objekte zu erzeugen und die vorhandenen zu ändern oder zu löschen. Die Welt kann somit vollständig von außen kontrolliert und beliebige Regeln in ihr umgesetzt werden. Würde man dies allerdings ohne weitere Einschränkungen ermöglichen würden das Ergebnis kein Spiel darstellen. Ein Spieler müsste nun kontinuierlich seine Positionseigenschaft manuell ändern und auf Kollisionen prüfen.\newline
Der Prototyp implementiert daher das Objektsystem auf einer 2D-Kachel-basierten Welt. Diese Darstellung ist einfach zu handhaben. Sowohl Algorithmen als auch die Interaktion mit der Welt werden dadurch vereinfacht. Weitere Funktionalität wird durch einige Eigenschaften geboten, welche ein flüssiges Spielerlebnis nach festen regeln einfügen. Diese Regeln können zwar nicht geändert werden, bei Bedarf ist aber immer die Umgehung durch manuelle Einwirkung möglich.\newline


\subsection{Eigenschaften}
\label{sec:Eigenschaften}
Eine Eigenschaft in den Objekten ist als Name-Wert Paar definiert. Wobei beide als String gespeichert sind und damit beliebige Daten enthalten können. Es ist möglich dem System neue Eigenschaften hinzuzufügen. Dadurch kann grundsätzlich jedes Regelwerk und Rollenspiel in der Welt durchgeführt werden. Die Änderung dieser Werte geschieht zunächst manuell und ist somit nicht mehr als ein elektronischer Ersatz des Papiers, der eine Strukturierung der Daten einführt.\newline

\subsubsection{Rechnen mit Werten}
An verschieden Stellen ist es nun möglich die Werte auch als Formel zu interpretieren und auszuwerten. Eine gültige Formel kann aus folgenden Elementen bestehen:
\begin{itemize}
	\item Ganzen Zahlen: 42
	\item Zufälligen Würfeln: W20
	\item Referenzen auf andere Eigenschaften des selben Objekts: 'ST-Mod'
	\item Operatoren: +, -, *, /
\end{itemize}

Aus diesen Elementen können die typischen Regeln aus PnP-Spielen leicht umgesetzt werden. Der Würfel 'Wx' erzeugt bei jeder Auswertung eine neue Zahl im Bereich 1 bis x.

Außer dieser Auswertbarkeit, die für alle Eigenschaften gilt, gibt es auch vorgegebene Eigenschaften, die komplexere Interaktionen automatisieren.\newline
Ein Beispiel dafür ist 'Hindernis'. Der eingebaute Weg-such-Algorithmus berücksichtigt Felder mit Objekten dieser Eigenschaft als nicht betretbar.

\subsection{Rechtesystem}
\label{sec:Rechtesystem}
In der Regel darf nur der Spielleiter Eigenschaften hinzufügen und entfernen. Weiter kann ein Spieler nur Eigenschaften von Objekten verändern, die ihm gehören. Realisiert wird das dadurch, dass jede Eigenschaft die Rechte Löschbar, Editierbar und Sichtbar bekommt. Für Spieler wird anhand der Besitzer-Eigenschaft (wenn vorhanden) festgemacht, wie viel sie sehen und beeinflussen können.\newline
Diese Einschränkung soll verhindern, dass Spieler im großen Stil anfangen zu schummeln. Es ist immer möglich, dass ein Spieler sich unlautere Vorteile verschafft, allerdings ist das auch in der Papier-Variante möglich und das Vertrauen in einer Spielgruppe sollte das System nicht missbrauchen.

\section{Aktionssystem}
\label{sec:Aktionssystem}
Die Existenz von bestimmten Eigenschaften ermöglicht das Ausführen von vor-implementierten Aktionen. Nicht jede dieser Aktionen ist in jedem Rollenspiel die gleiche und muss bei bedarf durch manuelle Handlungen ersetzt werden. Vor allem die Implementation des Kampfsystems basiert auf dem D\&D Regelsystem.\newline
Da der Spieler unvorhergesehene Handlungen ausführen können soll gibt es zusätzlich die Freitextaktion, welche für jedes Objekt möglich ist. Dabei wird dem Spielleiter mitgeteilt, dass ein Spieler ein bestimmtes Objekt manipulieren will. Er kann daraufhin eine Entscheidung fällen und nötige Konsequenzen durchführen.

\section{Synchronisation}
Die einheitliche Darstellung der Welt durch Objekte erlaubt es das Spiel leicht über ein Netzwerk synchron zu halten. Immer wenn sich ein Objekt verändert meldet es dies allen anderen im Netzwerk selbstständig. Algorithmen müssen damit nicht den Multiplayer-Kontext berücksichtigen. Sie können direkt auf Objekten agieren.

Einige der Aktionen werden als Protokoll einer zweiseitigen Kommunikation zwischen Leiter und Spieler implementiert. Dazu werden unabhängig von der Welt noch weitere Nachrichten ausgetauscht. Ebenso wird der Chat durch zusätzliche Nachrichten realisiert.
